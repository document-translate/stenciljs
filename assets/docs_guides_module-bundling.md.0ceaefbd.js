import{_ as s,o as n,c as o,X as l}from"./chunks/framework.319defb2.js";const u=JSON.parse('{"title":"Module Bundling","description":"Module Bundling","frontmatter":{"description":"Module Bundling"},"headers":[],"relativePath":"docs/guides/module-bundling.md","filePath":"docs/guides/module-bundling.md"}'),a={name:"docs/guides/module-bundling.md"},e=l(`<h1 id="module-bundling" tabindex="-1">Module Bundling <a class="header-anchor" href="#module-bundling" aria-label="Permalink to &quot;Module Bundling&quot;">​</a></h1><p>Stencil uses <a href="https://rollupjs.org/guide/en/" target="_blank" rel="noreferrer">Rollup</a> under the hood to bundle your components. This guide will explain and recommend certain workarounds for some of the most common bundling issues you might encounter.</p><h2 id="one-component-per-module" tabindex="-1">One Component Per Module <a class="header-anchor" href="#one-component-per-module" aria-label="Permalink to &quot;One Component Per Module&quot;">​</a></h2><p>For Stencil to bundle your components most efficiently, you must declare a single component (class decorated with <code>@Component</code>) per <em>TypeScript</em> file, and the component itself <strong>must</strong> have a unique <code>export</code>. By doing so, Stencil is able to easily analyze the entire component graph within the app, and best understand how components should be bundled together. Under-the-hood it uses the Rollup bundler to efficiently bundled shared code together. Additionally, lazy-loading is a default feature of Stencil, so code-splitting is already happening automatically, and only dynamically importing components which are being used on the page.</p><p>Modules that contain a component are entry-points, which means that no other module should import anything from them.</p><p>The following example is <strong>NOT</strong> valid:</p><p><strong>src/components/my-cmp.tsx:</strong></p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// This module has a component, you cannot export anything else</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">someUtilFunction</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">do stuff</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Component</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">tag</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">my-cmp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyCmp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span></code></pre></div><p>In this case, the compiler will emit an error that looks like this:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> ERROR </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">  src/components/my-cmp.tsx:4:1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">To</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">allow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">efficient</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bundling,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">modules</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@Component</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">can</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">only</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">have</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">single</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">which</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">component</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">itself.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Any</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">other</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exports</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">should</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">be</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">moved</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">separate</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">file.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">For</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">further</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">information</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">check</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">out:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">https://stenciljs.com/docs/module-bundling</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">L4:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">someUtilFunction</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">L5:</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">console.log</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&#39;do stuff&#39;</span><span style="color:#89DDFF;">);</span></span></code></pre></div><p>The solution is to move any shared functions or classes to a different <code>.ts</code> file, like this:</p><p><strong>src/utils.ts:</strong></p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">someUtilFunction</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">do stuff</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>src/components/my-cmp.tsx:</strong></p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">someUtilFunction</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../utils.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Component</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">tag</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">my-cmp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyCmp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span></code></pre></div><p><strong>src/components/my-cmp-two.tsx:</strong></p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">someUtilFunction</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../utils.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Component</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">tag</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">my-cmp-two</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyCmpTwo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span></code></pre></div><h2 id="commonjs-dependencies" tabindex="-1">CommonJS Dependencies <a class="header-anchor" href="#commonjs-dependencies" aria-label="Permalink to &quot;CommonJS Dependencies&quot;">​</a></h2><p>Rollup depends on <a href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/" target="_blank" rel="noreferrer">ES modules (ESM)</a> to properly tree-shake the module graph, unfortunately, some third-party libraries ship their code using the <a href="https://requirejs.org/docs/commonjs.html" target="_blank" rel="noreferrer">CommonJS</a> module system, which is not ideal.</p><p>Since CommonJS libraries are still common today, Stencil comes with <a href="https://github.com/rollup/rollup-plugin-commonjs" target="_blank" rel="noreferrer"><code>rollup-plugin-commonjs</code></a> already installed and configured.</p><p>At compiler-time, the <code>rollup-plugin-commonjs</code> plugin does a best-effort to <strong>transform CommonJS into ESM</strong>, but this is not always an easy task. CommonJS is dynamic by nature, while ESM is static by design.</p><p>Stencil&#39;s config exposes a <code>commonjs</code> property that is passed down to the Rollup CommonJS plugin, you can use this setting to work around certain bundling issues.</p><h3 id="namedmodules-x-is-not-exported-by-x" tabindex="-1">NamedModules: X is not exported by X <a class="header-anchor" href="#namedmodules-x-is-not-exported-by-x" aria-label="Permalink to &quot;NamedModules: X is not exported by X&quot;">​</a></h3><p>Sometimes, Rollup is unable to properly static analyze CommonJS modules, and it misses some named exports. Fortunately, there is a workaround we can use.</p><p>As we already know, <code>stencil.config.ts</code> exposes a <code>commonjs</code> property, in this case, we can take advantage of <a href="https://github.com/rollup/rollup-plugin-commonjs#custom-named-exports" target="_blank" rel="noreferrer">the <code>namedExports</code> property</a>.</p><p>Let&#39;s say, Rollup fails, when trying to use the <code>hello</code> named export of the <code>commonjs-dep</code> module:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// NamedModules: hello is not exported by commonjs-dep</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hello</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">commonjs-dep</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>We can use the <code>config.commonjs.namedExports</code> setting in the <code>stencil.config.ts</code> file to work around the issue:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> config </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">commonjs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">namedExports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// commonjs-dep has a &quot;hello&quot; export</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">commonjs-dep</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">提示</p><p>We can set a map of <code>namedExports</code> for problematic dependencies, in this case, we are explicitly defining the named <code>hello</code> export in the <code>commonjs-dep</code> module.</p></div><p>For further information, check out the <a href="https://github.com/rollup/rollup-plugin-commonjs" target="_blank" rel="noreferrer">rollup-plugin-commonjs docs</a>.</p><h2 id="custom-rollup-plugins" tabindex="-1">Custom Rollup plugins <a class="header-anchor" href="#custom-rollup-plugins" aria-label="Permalink to &quot;Custom Rollup plugins&quot;">​</a></h2><p>Stencil provides an API to pass custom rollup plugins to the bundling process in <code>stencil.config.ts</code>. Under the hood, stencil ships with some built-in plugins including <code>node-resolve</code> and <code>commonjs</code>, since the execution order of some rollup plugins is important, stencil provides an API to inject custom plugin <strong>before node-resolve</strong> and after <strong>commonjs transform</strong>:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> config </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rollupPlugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">before</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// Plugins injected before rollupNodeResolve()</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">resolvePlugin</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">after</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// Plugins injected after commonjs()</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">nodePolyfills</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>As a rule of thumb, plugins that need to resolve modules, should be place in <code>before</code>, while code transform plugins like: <code>node-polyfills</code>, <code>replace</code>... should be placed in <code>after</code>. Follow the plugin&#39;s documentation to make sure it&#39;s executed in the right order.</p><h2 id="node-polyfills" tabindex="-1">Node Polyfills <a class="header-anchor" href="#node-polyfills" aria-label="Permalink to &quot;Node Polyfills{#node-polyfills}&quot;">​</a></h2><p>Depending on which libraries a project is dependent on, the <a href="https://www.npmjs.com/package/rollup-plugin-node-polyfills" target="_blank" rel="noreferrer">rollup-plugin-node-polyfills</a> plugin may be required. In such cases, an error message similar to the following will be displayed at build time.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> ERROR </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">  Bundling Node Builtin</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#FFCB6B;">For</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">crypto</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">be</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bundled</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">problematic-dep</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#FFCB6B;">ensure</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup-plugin-node-polyfills</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">installed</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#FFCB6B;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">added</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stencil</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">plugins.</span></span></code></pre></div><p>This is caused by some third-party dependencies that use <a href="https://nodejs.org/dist/latest-v10.x/docs/api/" target="_blank" rel="noreferrer">Node APIs</a> that are not available in the browser, the <code>rollup-plugin-node-polyfills</code> plugin works by transparently polyfilling this missing APIs in the browser.</p><h3 id="_1-install-rollup-plugin-node-polyfills" tabindex="-1">1. Install <code>rollup-plugin-node-polyfills</code>: <a class="header-anchor" href="#_1-install-rollup-plugin-node-polyfills" aria-label="Permalink to &quot;1. Install \`rollup-plugin-node-polyfills\`:&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollup-plugin-node-polyfills</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save-dev</span></span></code></pre></div><h3 id="_2-update-the-stencil-config-ts-file-including-the-plugin" tabindex="-1">2. Update the <code>stencil.config.ts</code> file including the plugin: <a class="header-anchor" href="#_2-update-the-stencil-config-ts-file-including-the-plugin" aria-label="Permalink to &quot;2. Update the \`stencil.config.ts\` file including the plugin:&quot;">​</a></h3><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Config</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@stencil/core</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> nodePolyfills </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup-plugin-node-polyfills</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Config</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mycomponents</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rollupPlugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">after</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">nodePolyfills</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">提示</p><p><code>rollup-plugin-node-polyfills</code> is a code-transform plugin, so it needs to run AFTER the commonjs transform plugin, that&#39;s the reason it&#39;s placed in the &quot;after&quot; array of plugins.</p></div><h2 id="strict-mode" tabindex="-1">Strict Mode <a class="header-anchor" href="#strict-mode" aria-label="Permalink to &quot;Strict Mode&quot;">​</a></h2><p>ES modules are always parsed in strict mode. That means that certain non-strict constructs (like octal literals) will be treated as syntax errors when Rollup parses modules that use them. Some older CommonJS modules depend on those constructs, and if you depend on them your bundle will blow up. There&#39;s nothing we can do about that.</p><p>Luckily, there is absolutely no good reason not to use strict mode for everything — so the solution to this problem is to lobby the authors of those modules to update them.</p><p><em>Source: <a href="https://github.com/rollup/rollup-plugin-commonjs#strict-mode" target="_blank" rel="noreferrer">https://github.com/rollup/rollup-plugin-commonjs#strict-mode</a></em></p>`,48),p=[e];function t(c,r,i,y,D,C){return n(),o("div",null,p)}const A=s(a,[["render",t]]);export{u as __pageData,A as default};
